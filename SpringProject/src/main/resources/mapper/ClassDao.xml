<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.market.model.ClassDAO">
	
	<!-- 전체 프립 수 -->
	<select id="totalallcount" parameterType="int" resultType="int">
		<![CDATA[
			select count(*) from frip_class where class_category1 = (select cate_one from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 금주의 프립 수 -->
	<select id="weekallcount" parameterType="int" resultType="int">
		<![CDATA[
			select count(*)
			from frip_class c 
			left outer join frip_option o on c.class_num = o.option_classNum
			join (select booking_classnum, count(*) count
			                 from frip_booking
			                 where booking_regdate
			                 between (select to_char(sysdate + (interval '-7' day), 'YYYY/MM/DD') from dual)
			                 and sysdate
			                 group by booking_classnum
			                 order by count desc) b 
			on c.class_num = b.booking_classNum
			where class_category1 = (select cate_one from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 신규 프립 수 -->
	<select id="newallcount" parameterType="int" resultType="int">
		<![CDATA[
			select count(*)
			from frip_class c 
			left join frip_option o on c.class_num = o.option_classNum
			join (select class_num, count(*) count
			                 from frip_class
			                 where class_regdate
			                 between (select to_char(sysdate + (interval '-7' day), 'YYYY/MM/DD') from dual)
			                 and sysdate
			                 group by class_num
			                 order by count desc) b 
			on c.class_num = b.class_num
			where class_category1 = (select cate_one from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 인기프립 리스트 가져오기 -->
	<select id="bestalllist" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select c.class_num, c.class_hash, c.class_title, c.class_image, c.class_endArea, c.class_regdate, o.option_price, o.option_editprice, r.review_score
			from frip_class c 
			left outer join frip_option o on c.class_num = o.option_classNum
			left outer join (select booking_classNum, count(*) count
			      from frip_booking
			      group by booking_classNum
			      order by count desc, booking_classNum asc) b 
			on c.class_num = b.booking_classNum
			left outer join (select review_classNum, avg(review_score) review_score
			      from frip_review
			      group by review_classNum) r 
			on c.class_num = r.review_classNum
			where class_category1 = (select cate_one from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 금주의프립 리스트 가져오기 -->
	<select id="weekalllist" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select c.class_num, c.class_hash, c.class_title, c.class_image, c.class_endArea, c.class_regdate, o.option_price, o.option_editprice, r.review_score
			from frip_class c 
			left outer join frip_option o on c.class_num = o.option_classNum
			join (select booking_classnum, count(*) count
			                 from frip_booking
			                 where booking_regdate
			                 between (select to_char(sysdate + (interval '-7' day), 'YYYY/MM/DD') from dual)
			                 and sysdate
			                 group by booking_classnum
			                 order by count desc) b 
			on c.class_num = b.booking_classNum
			left outer join (select review_classNum, avg(review_score) review_score
			                 from frip_review
			                 group by review_classNum) r 
			on c.class_num = r.review_classNum
			where class_category1 = (select cate_one from frip_category where cate_num = #{num})
			order by b.count desc, c.class_num asc
		]]>
	</select>
	
	<!-- 신규프립 리스트 가져오기 -->
	<select id="newalllist" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select c.class_num, c.class_hash, c.class_title, c.class_image, c.class_endArea, c.class_regdate, o.option_price, o.option_editprice, r.review_score
			from frip_class c 
			left join frip_option o on c.class_num = o.option_classNum
			join (select class_num, count(*) count
			                 from frip_class
			                 where class_regdate
			                 between (select to_char(sysdate + (interval '-7' day), 'YYYY/MM/DD') from dual)
			                 and sysdate
			                 group by class_num
			                 order by count desc) b 
			on c.class_num = b.class_num
			left outer join (select review_classNum, avg(review_score) review_score
			                 from frip_review
			                 group by review_classNum) r 
			on c.class_num = r.review_classNum
			where class_category1 = (select cate_one from frip_category where cate_num = #{num})
			order by c.class_regdate, c.class_num asc
		]]>
	</select>
	
	
	
	
	
	
	<!-- 카테고리의 이름 -->
	<select id="categoryname" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select distinct c.class_category1, c.class_category2, a.cate_num 
			from frip_class c 
			left join frip_category a
			on c.class_category2 = a.cate_two
			where class_category2 = (select cate_two from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 하위 카테고리 리스트 -->
	<select id="categorynamelist" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select cate_num, cate_two from frip_category where cate_one = (select cate_one from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 프립 전체 리스트 가져오기 -->
	<select id="alllist1" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select c.class_num, c.class_hash, c.class_title, c.class_category1, c.class_category2, c.class_image, c.class_endArea, c.class_regdate, o.option_price, o.option_editprice, r.review_score
			from frip_class c 
			left outer join frip_option o on c.class_num = o.option_classNum
			left outer join (select review_classNum, avg(review_score) review_score
			                 from frip_review
			                 group by review_classNum) r 
			on c.class_num = r.review_classNum
			where class_category1 = (select cate_one from frip_category where cate_num = #{num})
			order by c.class_regdate desc
		]]>
	</select>
	
	
	
	<!-- 하위카테고리 -->
	<!-- 하위카테고리 전체 프립 수 -->
	<select id="totalcount" parameterType="int" resultType="int">
		<![CDATA[
			select count(*) from frip_class where class_category2 = (select cate_two from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 하위카테고리 금주의 프립 수 -->
	<select id="weekcount" parameterType="int" resultType="int">
		<![CDATA[
			select count(*)
			from frip_class c 
			left outer join frip_option o on c.class_num = o.option_classNum
			join (select booking_classnum, count(*) count
			                 from frip_booking
			                 where booking_regdate
			                 between (select to_char(sysdate + (interval '-7' day), 'YYYY/MM/DD') from dual)
			                 and sysdate
			                 group by booking_classnum
			                 order by count desc) b 
			on c.class_num = b.booking_classNum
			where class_category2 = (select cate_two from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 하위카테고리 신규 프립 수 -->
	<select id="newcount" parameterType="int" resultType="int">
		<![CDATA[
			select count(*)
			from frip_class c 
			left join frip_option o on c.class_num = o.option_classNum
			join (select class_num, count(*) count
			                 from frip_class
			                 where class_regdate
			                 between (select to_char(sysdate + (interval '-7' day), 'YYYY/MM/DD') from dual)
			                 and sysdate
			                 group by class_num
			                 order by count desc) b 
			on c.class_num = b.class_num
			where class_category2 = (select cate_two from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 하위카테고리 인기프립 리스트 가져오기 -->
	<select id="bestlist" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select c.class_num, c.class_hash, c.class_title, c.class_image, c.class_endArea, c.class_regdate, o.option_price, o.option_editprice, r.review_score
			from frip_class c 
			left outer join frip_option o on c.class_num = o.option_classNum
			left outer join (select booking_classNum, count(*) count
			      from frip_booking
			      group by booking_classNum
			      order by count desc, booking_classNum asc) b 
			on c.class_num = b.booking_classNum
			left outer join (select review_classNum, avg(review_score) review_score
			      from frip_review
			      group by review_classNum) r 
			on c.class_num = r.review_classNum
			where class_category2 = (select cate_two from frip_category where cate_num = #{num})
		]]>
	</select>
	
	<!-- 하위카테고리 금주의프립 리스트 가져오기 -->
	<select id="weeklist" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select c.class_num, c.class_hash, c.class_title, c.class_image, c.class_endArea, c.class_regdate, o.option_price, o.option_editprice, r.review_score
			from frip_class c 
			left outer join frip_option o on c.class_num = o.option_classNum
			join (select booking_classnum, count(*) count
			                 from frip_booking
			                 where booking_regdate
			                 between (select to_char(sysdate + (interval '-7' day), 'YYYY/MM/DD') from dual)
			                 and sysdate
			                 group by booking_classnum
			                 order by count desc) b 
			on c.class_num = b.booking_classNum
			left outer join (select review_classNum, avg(review_score) review_score
			                 from frip_review
			                 group by review_classNum) r 
			on c.class_num = r.review_classNum
			where class_category2 = (select cate_two from frip_category where cate_num = #{num})
			order by b.count desc, c.class_num asc
		]]>
	</select>
	
	<!-- 하위카테고리 신규프립 리스트 가져오기 -->
	<select id="newlist" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select c.class_num, c.class_hash, c.class_title, c.class_image, c.class_endArea, c.class_regdate, o.option_price, o.option_editprice, r.review_score
			from frip_class c 
			left join frip_option o on c.class_num = o.option_classNum
			join (select class_num, count(*) count
			                 from frip_class
			                 where class_regdate
			                 between (select to_char(sysdate + (interval '-7' day), 'YYYY/MM/DD') from dual)
			                 and sysdate
			                 group by class_num
			                 order by count desc) b 
			on c.class_num = b.class_num
			left outer join (select review_classNum, avg(review_score) review_score
			                 from frip_review
			                 group by review_classNum) r 
			on c.class_num = r.review_classNum
			where class_category2 = (select cate_two from frip_category where cate_num = #{num})
			order by c.class_regdate, c.class_num asc
		]]>
	</select>
	
	<!-- 하위 카테고리 프립 전체 리스트 가져오기 -->
	<select id="alllist2" parameterType="int" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select c.class_num, c.class_hash, c.class_title, c.class_category1, c.class_category2, c.class_image, c.class_endArea, c.class_regdate, o.option_price, o.option_editprice, r.review_score
			from frip_class c 
			left outer join frip_option o on c.class_num = o.option_classNum
			left outer join (select review_classNum, avg(review_score) review_score
			                 from frip_review
			                 group by review_classNum) r 
			on c.class_num = r.review_classNum
			where class_category2 = (select cate_two from frip_category where cate_num = #{num})
			order by c.class_regdate desc
		]]>
	</select>
	
	
	
</mapper>