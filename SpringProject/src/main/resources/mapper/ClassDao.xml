<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.market.model.ClassDAO">
	<select id="countClass" resultType="int">
		select count(*)+1 from frip_class 
	</select>
	
	<insert id="insertClass" parameterType="com.market.model.ClassDTO">
		
		insert into frip_class values(#{class_num},#{class_memNum},#{class_category1}
				,#{class_category2}, #{class_hash}, #{class_title}, #{class_image},#{class_startDate},#{class_endDate},
				 #{class_count}, #{class_startArea},#{class_startAreaDetail}, #{class_endArea},#{class_endAreaDetail}, 
				 #{class_cont}, #{class_plan}, #{class_include},
				#{class_exclude}, #{class_supply}, #{class_notice}, default, sysdate, default, default)
	</insert>
	
	<select id="getList_MemNum" parameterType="java.util.Map" resultType="com.market.model.ClassDTO">
		<![CDATA[
			select distinct * from frip_class f
			where class_memnum = #{mem_num}
			and class_pass = #{class_pass} 
			and class_delcheck = 'no'
            and class_startdate > sysdate
		]]>
	</select>
	
	<select id="getList_endClass" parameterType="java.util.Map" resultType="com.market.model.ClassDTO">
		select * from frip_class where class_memnum = #{mem_num}  
			and class_pass = #{class_pass} and class_delcheck = 'no'
	</select>
	
	<select id="getList_classNum" parameterType="int" resultType="com.market.model.ClassDTO">
		select * from frip_class where class_num = #{class_num}
	</select>

	<select id="fripPass_wait" resultType="com.market.model.ClassDTO">
		select *
		from frip_class c join frip_member m
		on c.class_memnum = m.mem_num
		where c.class_pass = 0 order by class_regdate desc, class_num
	</select>
	
	<select id="fripPass_wait_count" resultType="Integer">
		select count(*)
		from frip_class c join frip_member m
		on c.class_memnum = m.mem_num
		where c.class_pass = 0
	</select>
	
	<select id="fripPass_finish" resultType="com.market.model.ClassDTO">
		select *
		from frip_class c join frip_member m
		on c.class_memnum = m.mem_num
		where c.class_pass = 1 order by class_pass_regdate desc, class_num
	</select>
	
	<select id="fripPass_finish_count" resultType="Integer">
		select count(*)
		from frip_class c join frip_member m
		on c.class_memnum = m.mem_num
		where c.class_pass = 1
	</select>
	
	<update id="fripPass_result" parameterType="int">
		update frip_class set class_pass = 1, class_pass_regdate = sysdate where class_num = #{class_num}
	</update>
	
	<update id="updateClass" parameterType="com.market.model.ClassDTO" >
		update frip_class set 
		class_category1=#{class_category1}
		,class_category2=#{class_category2},class_hash = #{class_hash}, class_title=#{class_title}, 
		class_image=#{class_image},class_startDate=#{class_startDate},class_endDate=#{class_endDate},
		class_count=#{class_count},class_startArea=#{class_startArea},
		class_startAreaDetail=#{class_startAreaDetail}, class_endArea=#{class_endArea},
		class_endAreaDetail=#{class_endAreaDetail}, class_cont=#{class_cont},
		class_plan= #{class_plan}, class_include=#{class_include},
		class_exclude=#{class_exclude},class_supply=#{class_supply},class_notice= #{class_notice}
		where class_num = #{class_num}
	</update>
	
	<select id="countClass_memnum" parameterType="int" resultType="int" >
		select count(*) from frip_class where class_memnum = #{mem_num}
	</select>
	
	<select id="getList" parameterType="java.util.Map" resultType="com.market.model.ClassDTO">
		<![CDATA[
		select * from (select b.*, row_number() over(order by class_num) rnum from frip_class b where class_memnum = #{mem_num}) 
			where rnum >= #{dto.startNo} and rnum <= #{dto.endNo}
		]]>
	</select>
	
	<update id="entercheck" parameterType="int">
		update frip_booking set booking_entercheck = 'yes' where booking_num = #{booking_num}
	</update>
	
	<update id="entercancel" parameterType="int">
		update frip_booking set booking_entercheck = 'no' where booking_num = #{booking_num}
	</update>
	
	<select id="count_endClass" parameterType="int" resultType="int">
		select count(*) from frip_class where class_memnum = #{mem_num}  
			and class_pass = 1 and class_delcheck = 'no'
	</select>

</mapper>